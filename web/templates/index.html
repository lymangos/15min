<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>15分钟生活圈分析系统</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- Umami Analytics -->
    <script defer src="https://stats.woodland-mango.click/script.js" data-website-id="1a0eb539-3ef9-434c-8847-2f7f3482f53a"></script>
</head>
<body>
    <div class="app-container">
        <!-- 移动端顶部栏 -->
        <header class="mobile-header">
            <button id="toggle-sidebar" class="toggle-sidebar-btn">☰</button>
            <h1>🏘️ 15分钟生活圈</h1>
            <button id="mobile-locate-btn" class="mobile-locate-btn">📍</button>
        </header>

        <!-- 侧边栏 -->
        <aside class="sidebar" id="sidebar">
            <header class="sidebar-header">
                <h1>🏘️ 15分钟生活圈</h1>
                <p class="subtitle">城市服务可达性分析系统</p>
                <button id="close-sidebar" class="close-sidebar-btn">✕</button>
            </header>

            <div class="sidebar-content">
                <!-- 城市选择 -->
                <section class="panel" id="city-panel">
                    <h3>🏙️ 选择城市</h3>
                    <div class="city-selector-container">
                        <select id="city-selector" class="city-selector">
                            <!-- 由 JS 动态填充 -->
                        </select>
                    </div>
                    <p class="city-info" id="city-info">浙江省杭州市</p>
                </section>

                <!-- 地址搜索 -->
                <section class="panel" id="search-panel">
                    <h3>🔍 地址搜索</h3>
                    <div class="search-container">
                        <input type="text" id="search-input" placeholder="输入地址或POI名称..." autocomplete="off">
                        <button id="search-btn" class="search-btn" title="搜索">🔍</button>
                        <button id="locate-btn" class="locate-btn" title="定位到当前位置">📍</button>
                    </div>
                    <div id="search-results" class="search-results" style="display: none;"></div>
                </section>

                <!-- 当前坐标 -->
                <section class="panel">
                    <h3>📌 当前位置</h3>
                    <div id="current-location">
                        <p class="placeholder">请在地图上点击选择位置</p>
                    </div>
                </section>

                <!-- 分析结果 -->
                <section class="panel result-panel" id="result-panel" style="display: none;">
                    <h3>📊 分析结果</h3>
                    
                    <!-- 总体评分 -->
                    <div class="score-card" id="score-card">
                        <div class="score-circle">
                            <span class="score-value" id="total-score">--</span>
                            <span class="score-label">分</span>
                        </div>
                        <div class="grade-badge" id="grade-badge">-</div>
                    </div>
                    
                    <p class="summary" id="result-summary"></p>

                    <!-- 雷达图 -->
                    <div class="radar-chart-container">
                        <div id="radar-chart"></div>
                    </div>

                    <!-- 分类评分 -->
                    <div class="category-scores" id="category-scores">
                        <!-- 动态生成 -->
                    </div>

                    <!-- 改进建议 -->
                    <div class="suggestions" id="suggestions">
                        <h4>💡 改进建议</h4>
                        <ul id="suggestion-list"></ul>
                    </div>
                </section>

                <!-- POI 分类筛选 -->
                <section class="panel" id="poi-filter-panel">
                    <h3>🔍 POI筛选</h3>
                    <div class="poi-filter-controls">
                        <label class="filter-checkbox">
                            <input type="checkbox" id="filter-all" checked>
                            <span class="checkmark"></span>
                            <span>全选/取消</span>
                        </label>
                    </div>
                    <div class="poi-filter-list" id="poi-filter-list">
                        <label class="filter-checkbox" data-category="medical">
                            <input type="checkbox" checked style="--check-color: #e74c3c;">
                            <span>🏥 医疗卫生</span>
                        </label>
                        <label class="filter-checkbox" data-category="education">
                            <input type="checkbox" checked style="--check-color: #3498db;">
                            <span>🏫 教育设施</span>
                        </label>
                        <label class="filter-checkbox" data-category="elderly">
                            <input type="checkbox" checked style="--check-color: #e67e22;">
                            <span>👴 养老服务</span>
                        </label>
                        <label class="filter-checkbox" data-category="commerce">
                            <input type="checkbox" checked style="--check-color: #f39c12;">
                            <span>🛒 商业服务</span>
                        </label>
                        <label class="filter-checkbox" data-category="culture">
                            <input type="checkbox" checked style="--check-color: #27ae60;">
                            <span>🎭 文化体育</span>
                        </label>
                        <label class="filter-checkbox" data-category="public">
                            <input type="checkbox" checked style="--check-color: #9b59b6;">
                            <span>🏛️ 公共管理</span>
                        </label>
                        <label class="filter-checkbox" data-category="transport">
                            <input type="checkbox" checked style="--check-color: #1abc9c;">
                            <span>🚌 交通设施</span>
                        </label>
                        <label class="filter-checkbox" data-category="child">
                            <input type="checkbox" checked style="--check-color: #ff69b4;">
                            <span>👶 托幼托育</span>
                        </label>
                    </div>
                </section>

                <!-- 等时圈图层控制 -->
                <section class="panel" id="isochrone-control-panel">
                    <h3>🗺️ 等时圈显示</h3>
                    <div class="isochrone-controls">
                        <label class="isochrone-toggle">
                            <input type="checkbox" id="isochrone-5" checked style="--toggle-color: #22c55e;">
                            <span class="toggle-label">5分钟生活圈</span>
                        </label>
                        <label class="isochrone-toggle">
                            <input type="checkbox" id="isochrone-10" checked style="--toggle-color: #3b82f6;">
                            <span class="toggle-label">10分钟生活圈</span>
                        </label>
                        <label class="isochrone-toggle">
                            <input type="checkbox" id="isochrone-15" checked disabled style="--toggle-color: #f97316;">
                            <span class="toggle-label">15分钟生活圈（必选）</span>
                        </label>
                        <label class="isochrone-toggle" style="margin-top: 8px; border-top: 1px dashed #e2e8f0; padding-top: 10px;">
                            <input type="checkbox" id="show-roads" style="--toggle-color: #6b7280;">
                            <span class="toggle-label">🛣️ 显示道路网络</span>
                        </label>
                    </div>
                </section>

                <!-- 步行速度配置 -->
                <section class="panel" id="speed-config-panel">
                    <h3>🚶 步行速度</h3>
                    <div class="speed-presets">
                        <button class="speed-preset" data-speed="3.5" title="适合老人、儿童">🧓 慢速</button>
                        <button class="speed-preset active" data-speed="5.0" title="正常步行速度">🚶 正常</button>
                        <button class="speed-preset" data-speed="6.0" title="快步行走">🏃 快速</button>
                    </div>
                    <div class="speed-custom">
                        <label for="walk-speed">自定义速度：</label>
                        <div class="speed-input-group">
                            <input type="range" id="walk-speed" min="3.0" max="7.0" step="0.1" value="5.0">
                            <span class="speed-value" id="speed-display">5.0</span>
                            <span class="speed-unit">km/h</span>
                        </div>
                    </div>
                    <p class="speed-hint">
                        当前速度下，15分钟可步行 <strong id="walk-distance">1250</strong> 米
                    </p>
                </section>

                <!-- 图例 -->
                <section class="panel">
                    <h3>🎨 图例</h3>
                    <div class="legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: rgba(34, 197, 94, 0.5);"></span>
                            <span>5分钟步行圈</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: rgba(59, 130, 246, 0.45);"></span>
                            <span>10分钟步行圈</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: rgba(249, 115, 22, 0.35);"></span>
                            <span>15分钟步行圈</span>
                        </div>
                    </div>
                </section>
            </div>

            <footer class="sidebar-footer">
                <p>© 2026 15分钟生活圈项目</p>
                <p>基于 本地及高德 数据</p>
            </footer>
        </aside>

        <!-- 移动端侧边栏遮罩 -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- 地图容器 -->
        <main class="map-container">
            <div id="map"></div>
            
            <!-- 分析进度遮罩和面板（在地图内部） -->
            <div class="map-progress-overlay" id="progress-overlay">
                <div class="analysis-progress" id="analysis-progress">
                    <div class="progress-header">
                        <div class="spinner-small"></div>
                        <span>正在分析</span>
                    </div>
                    <div class="progress-log" id="progress-log"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- ECharts 雷达图 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <script src="/static/js/app.js"></script>
</body>
</html>
